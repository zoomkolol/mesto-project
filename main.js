(()=>{"use strict";var e=function(e){e.setAttribute("disabled","")},t=function(t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?n.removeAttribute("disabled"):e(n)},n=document.querySelectorAll(".popup"),o=document.querySelector(".popup__edit-profile"),r=document.querySelector(".popup__edit-card"),c=document.querySelector(".popup__edit-avatar");function u(e){document.addEventListener("keydown",i),e.classList.add("popup_opened")}function a(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",i)}function i(e){"Escape"===e.key&&a(document.querySelector(".popup_opened"))}n.forEach((function(e){return e.addEventListener("click",(function(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup__overlay"))&&function(e){a(e.closest(".popup"))}(e.target)}))}));var s={baseUrl:"https://nomoreparties.co/v1/plus-cohort-26",headers:{authorization:"2c7dd9fd-d8e0-4401-88fd-d84a69cc2a4c","Content-Type":"application/json"}},d=document.querySelector("#card-template").content;function l(e,t,n){t.textContent=e,n.target.classList.toggle("card__like_active")}var p,f,m,h,_,v,y=document.querySelector(".profile"),S=y.querySelector(".profile__edit"),q=y.querySelector(".profile__add"),k=y.querySelector(".profile__avatar-container"),g=document.querySelector(".popup__image"),b=document.querySelector(".popup__img-description"),E=document.querySelector(".popup__image-container"),L=document.querySelector(".profile__name"),C=document.querySelector(".profile__description"),j=document.querySelector(".profile__avatar"),x=document.querySelector("#popup__submit-edit-profile_btn"),A=document.querySelector("#popup__submit-edit-card_btn"),P=document.querySelector("#popup__submit-edit-avatar_btn"),T=document.forms["edit-profile"],w=document.forms["edit-card"],N=document.forms["edit-avatar"],O=document.querySelector('input[name="name"]'),D=document.querySelector('input[name="status"]'),J=document.querySelector('input[name="avatar"]'),M=document.querySelector('input[name="place"]'),B=document.querySelector('input[name="link"]'),H=document.querySelector(".cards");function U(e,t){e.textContent=t?"Сохранение...":"Сохранить"}function V(e,t){L.textContent=e,C.textContent=t}function z(e,t){u(E),g.setAttribute("src",e),g.setAttribute("alt",t),b.textContent=t}function F(e,t){var n;(n=e,fetch("https://nomoreparties.co/v1/plus-cohort-26/cards/".concat(n),{method:"DELETE",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then(function(e){e.target.closest(".card").remove()}(t)).catch((function(e){return console.log(e)}))}function G(e,t,n){var o;n.target.classList.contains("card__like_active")?(o=e,fetch("https://nomoreparties.co/v1/plus-cohort-26/cards/likes/".concat(o),{method:"DELETE",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){return l(e.likes.length,t,n)})).catch((function(e){return console.log(e)})):function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-26/cards/likes/".concat(e),{method:"PUT",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){return l(e.likes.length,t,n)})).catch((function(e){return console.log(e)}))}function I(e,t,n,o,r,c,u){var a=function(e,t,n,o,r,c,u,a,i){null==n&&console.log("cardName is "+n);var s=d.querySelector(".card").cloneNode(!0),l=s.querySelector(".card__image"),p=s.querySelector(".card__description"),f=s.querySelector(".card__like-counter"),m=s.querySelector(".card__delete"),h=s.querySelector(".card__like");return p.textContent=n,l.setAttribute("src",o),l.setAttribute("alt",n),f.textContent=r.length,r.find((function(t){return t._id===e}))&&h.classList.add("card__like_active"),h.addEventListener("click",(function(e){a(c,f,e)})),e!==t?m.remove():m.addEventListener("click",(function(e){i(c,e)})),l.addEventListener("click",(function(){return u(o,n)})),s}(e,t,n,o,r,c,z,G,F);u?H.append(a):H.prepend(a)}fetch("https://nomoreparties.co/v1/plus-cohort-26/users/me",{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){V(e.name,e.about),j.src=e.avatar;var t=e._id;fetch("https://nomoreparties.co/v1/plus-cohort-26/cards",{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){I(t,e.owner._id,e.name,e.link,e.likes,e._id,!0)}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})),f=(p={formSelector:".popup__form",inputSelector:".popup__text",submitButtonSelector:".popup__submit",inputErrorClass:"popup__text_type_error",errorClass:"popup__text_error_active"}).formSelector,m=p.inputSelector,h=p.submitButtonSelector,_=p.inputErrorClass,v=p.errorClass,Array.from(document.querySelectorAll(f)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(n,o,r,c,u){var a=Array.from(n.querySelectorAll(o)),i=n.querySelector(r);t(a,i),n.addEventListener("reset",(function(){e(i)})),a.forEach((function(e){e.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"_error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"_error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)}(n,e,c,u),t(a,i)}))}))}(n,m,h,_,v)})),S.addEventListener("click",(function(){O.value=L.textContent,D.value=C.textContent,u(o)})),q.addEventListener("click",(function(){u(r)})),k.addEventListener("click",(function(){u(c)})),T.addEventListener("submit",(function(){var e,t;U(x,!0),(e=O.value,t=D.value,fetch("https://nomoreparties.co/v1/plus-cohort-26/users/me",{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){V(e.name,e.about),a(o)})).catch((function(e){return console.log(e)})).finally((function(){U(x,!1)}))})),N.addEventListener("submit",(function(){var e;U(P,!0),(e=J.value,fetch("https://nomoreparties.co/v1/plus-cohort-26/users/me/avatar",{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){j.src=e.avatar,a(c),N.reset()})).catch((function(e){return console.log(e)})).finally((function(){U(P,!1)}))})),w.addEventListener("submit",(function(){var e,t;U(A,!0),(e=M.value,t=B.value,fetch("https://nomoreparties.co/v1/plus-cohort-26/cards",{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){I(e.owner._id,e.owner._id,e.name,e.link,e.likes,e._id,!1),a(r),w.reset()})).catch((function(e){return console.log(e)})).finally((function(){U(A,!1)}))}))})();